ในวันหนึ่ง มีรุ่นพี่ที่ได้รับ Assignment วิชา ToC ว่าให้เขียน Web Crawler เพื่อดึงข้อมูลของหัวข้อที่สนใจจากเว็บที่เลือก รุ่นพี่คนนั้นจึงเลือกที่จะดึงข้อมูลของหนังภาพยนตร์ออกมา จากเว็บให้คะแนนหนังชื่อดังเว็บหนึ่ง

แต่หลังจากได้ข้อมูลของหนังแต่ละเรื่องมาแล้ว กลับลืมว่าต้องคิดโจทย์ให้นักศึกษาภาคคอมกลุ่มนึงที่กำลังนัวกับวิชาวาดรูปของภาคคอมอยู่ จึงได้ให้โจทย์นักศึกษากลุ่มนั้นไปทำ โดย

จากโค้ดตัวอย่างจะมีข้อมูลชื่อหนังพร้อมเรทติ้งอยู่ อยากให้
เก็บข้อมูลเหล่านี้ในรูปแบบของ AVL Tree โดยใช้เรทติ้งของหนังในการเรียงข้อมูล และสามารถใช้ฟีเจอร์เหล่านี้ได้

T n - ลิสต์รายชื่อหนังที่มีเรทติ้งมากที่สุด n ลำดับแรกมา

R a b - ลิสต์รายชื่อหนังทั้งหมดที่มีเรทติ้งอยู่ในช่วง a ถึง b

I m r - สามารถเพิ่มหนังชื่อเรื่อง m เรทติ้ง r ไปเก็บไว้เพิ่มจากที่มีอยู่เดิมได้ (ถ้าเรทติ้งเท่ากันให้ insert ไปทางขวา)

D m - สามารถลบข้อมูลหนังชื่อเรื่อง m ได้ (inorder successor)



*เหตุการณ์ทั้งหมดข้างต้นรวมถึงเรทติ้งของหนังเป็นเพียงเรื่องแต่งเท่านั้น ไม่มีส่วนเกี่ยวข้องกับชีวิตจริง

**ต้องใช้ AVL Tree ในการเก็บข้อมูลหนังแต่ละเรื่องเป็นแต่ละ Node เท่านั้น และเพื่อความง่ายแนะนำให้นำโค้ดตัวอย่างไปเขียนต่อได้เลย แต่ห้ามแก้ไขโค้ดส่วนที่ไม่ได้เว้นไว้ให้ สามารถเขียนฟังก์ชันเพิ่มเติมได้ตามความเหมาะสม

class AVLTree:
    def __init__(self):
        self.root = None

    def insertMovie(self, movie):  
        self.root = self._insert(self.root, movie)

    def _insert(self, node, movie):
        if not node:
            return Node(Movie(movie[0], movie[1]))
        ###
        ### Let you cook
        ###
        pass

    def removeMovie(self, movieName):
        self.root = self._remove(self.root, movieName)

    def _remove(self, node, movieName):
        if not node:
            return node
        ###
        ### Let you cook
        ###
        pass
    

    def top(self, number):
        return self._top(self.root, number)

    def _top(self, node, number):
        if node is None or number == 0:
            return []
        ##
        ### Let you cook
        ##
        pass

    def getRatingRange(self, start, end):
        return self._getRatingRange(self.root, start, end)

    def _getRatingRange(self, node, start, end):
        if node is None:
            return []
        ###
        ### Let you cook
        ###
        pass
    
    def balance(self, node):    #balance current node which return new root node
        BF = node.balanceFactor()
        ###
        ### Let you cook
        ###
        pass

    def getMin(self, node): #Get minimum rating node
        current = node
        while current.left:
            current = current.left
        return current
    
    def printTree(self, node, level=0):
        if node is not None:
            self.printTree(node.right, level + 1)
            print('     ' * level, node)
            self.printTree(node.left, level + 1)

    def isAVL(self):
        return self._isAVL(self.root)

    def _isAVL(self, node):
        if not node:
            return True
        if abs(node.balanceFactor()) > 1:
            return False
        expected_height = 1 + max(node.left.height if node.left else -1, node.right.height if node.right else -1)
        if node.height != expected_height:
            return False
        return self._isAVL(node.left) and self._isAVL(node.right)
    
    def isBST(self):
        return self._isBST(self.root)

    def _isBST(self, node, min=float('-inf'), max=float('inf')):
        if not node:
            return True
        if not (min <= node.data.rating <= max):
            return False
        return (self._isBST(node.left, min, node.data.rating) and
                self._isBST(node.right, node.data.rating, max))

class Node:
    def __init__(self, data):
        self.data = data
        self.left = None
        self.right = None
        self.height = 0

    def __str__(self):
        return f'{self.data}'
    
    def balanceFactor(self):    #Get balance factor
        if not self:
            return -1
        left_height = self.left.height if self.left else -1
        right_height = self.right.height if self.right else -1
        return right_height - left_height
    
    def setHeight(self):        #Set height base on child node
        a = self.left.height if self.left else -1  
        b = self.right.height if self.right else -1
        self.height = 1 + max(a,b)

    def rotateRight(self):      #Rotate right (clockwise)
        new_root = self.left
        self.left = new_root.right
        new_root.right = self
        self.setHeight()
        new_root.setHeight()
        return new_root
    
    def rotateLeft(self):       #Rotate left (counter-clockwise)
        new_root = self.right
        self.right = new_root.left
        new_root.left = self
        self.setHeight()
        new_root.setHeight()
        return new_root
        
class Movie:
    def __init__(self, title, rating):
        self.title = title
        self.rating = float(rating)

    def __str__(self):
        return f'{self.title}({self.rating})'

rottenPotato = AVLTree()
movies = [
    ("Megalodon", 5.0),
    ("Inception", 9.1),
    ("The_Dark_Knight", 8.9),
    ("Interstellar", 9.4),
    ("Tenet", 7.2),
    ("Memento", 7.9),
    ("Dunkirk", 7.7),
    ("The_Prestige", 8.3),
    ("Avatar", 7.8),
    ("Titanic", 8.1),
    ("Gladiator", 8.6),
    ("The_Matrix", 9.3),
    ("John_Wick", 7.5),
    ("Parasite", 9.0),
    ("Whiplash", 8.5),
    ("La_La_Land", 8.0),
    ("The_Godfather", 9.2),
    ("Pulp_Fiction", 8.4),
    ("Fight_Club", 8.7),
    ("Forrest_Gump", 8.8)
]

for movie in movies:
    rottenPotato.insertMovie(movie)

inp = input("The Requests From User: ").split(", ")
for request in inp:
    req = request.split(" ")
    if req[0] == "I":
        rottenPotato.insertMovie([req[1], float(req[2])])
    elif req[0] == "D":
        rottenPotato.removeMovie(req[1])
    elif req[0] == "T":
        print(f"Top {req[1]}")
        print([str(movie) for movie in rottenPotato.top(int(req[1]))])
        print()
    elif req[0] == "R":
        print(f'Rating range from {req[1]} to {req[2]}')
        print([str(movie) for movie in rottenPotato.getRatingRange(float(req[1]), float(req[2]))])
        print()
print(f'Is this AVL Tree? {rottenPotato.isAVL() and rottenPotato.isBST()}')

Testcase student: #1/7
The Requests From User: T 3, R 7.4 8.2
Top 3
['Interstellar(9.4)', 'The_Matrix(9.3)', 'The_Godfather(9.2)']

Rating range from 7.4 to 8.2
['John_Wick(7.5)', 'Dunkirk(7.7)', 'Avatar(7.8)', 'Memento(7.9)', 'La_La_Land(8.0)', 'Titanic(8.1)']

Is this AVL Tree? True

Testcase student: #2/7
The Requests From User: I Oppenheimer 9.9, D La_La_Land, R 7.9 8.5, T 2
Rating range from 7.9 to 8.5
['Memento(7.9)', 'Titanic(8.1)', 'The_Prestige(8.3)', 'Pulp_Fiction(8.4)', 'Whiplash(8.5)']

Top 2
['Oppenheimer(9.9)', 'Interstellar(9.4)']

Is this AVL Tree? True

Testcase student: #3/7
The Requests From User: R 4 7.5, D Memento, D The_Prestige, D Interstellar, T 5
Rating range from 4 to 7.5
['Megalodon(5.0)', 'Tenet(7.2)', 'John_Wick(7.5)']

Top 5
['The_Matrix(9.3)', 'The_Godfather(9.2)', 'Inception(9.1)', 'Parasite(9.0)', 'The_Dark_Knight(8.9)']

Is this AVL Tree? True

Testcase student: #4/7
The Requests From User: I A 4.4, I B 8.9, I C 8.5, R 4.3 5, R 8.5 9, D B, D Gladiator, R 0 10
Rating range from 4.3 to 5
['A(4.4)', 'Megalodon(5.0)']

Rating range from 8.5 to 9
['Whiplash(8.5)', 'C(8.5)', 'Gladiator(8.6)', 'Fight_Club(8.7)', 'Forrest_Gump(8.8)', 'The_Dark_Knight(8.9)', 'B(8.9)', 'Parasite(9.0)']

Rating range from 0 to 10
['A(4.4)', 'Megalodon(5.0)', 'Tenet(7.2)', 'John_Wick(7.5)', 'Dunkirk(7.7)', 'Avatar(7.8)', 'Memento(7.9)', 'La_La_Land(8.0)', 'Titanic(8.1)', 'The_Prestige(8.3)', 'Pulp_Fiction(8.4)', 'Whiplash(8.5)', 'C(8.5)', 'Fight_Club(8.7)', 'Forrest_Gump(8.8)', 'The_Dark_Knight(8.9)', 'Parasite(9.0)', 'Inception(9.1)', 'The_Godfather(9.2)', 'The_Matrix(9.3)', 'Interstellar(9.4)']

Is this AVL Tree? True

Testcase student: #5/7
The Requests From User: D Avatar, D Fight_Club, D Whiplash, D John_Wick, D Inception, T 15
Top 15
['Interstellar(9.4)', 'The_Matrix(9.3)', 'The_Godfather(9.2)', 'Parasite(9.0)', 'The_Dark_Knight(8.9)', 'Forrest_Gump(8.8)', 'Gladiator(8.6)', 'Pulp_Fiction(8.4)', 'The_Prestige(8.3)', 'Titanic(8.1)', 'La_La_Land(8.0)', 'Memento(7.9)', 'Dunkirk(7.7)', 'Tenet(7.2)', 'Megalodon(5.0)']

Is this AVL Tree? True

Testcase student: #6/7
The Requests From User: I A 4, I B 4, I C 4, I D 4, I E 4, I F 4, I G 4, I H 4
Is this AVL Tree? True

Testcase student: #7/7
The Requests From User: I A 4, I B 5, I C 4, I D 10, I E 7.5, I F 4, I G 9.9, I H 9.8, T 2, D H, R 9 10, R 4 4
Top 2
['D(10.0)', 'G(9.9)']

Rating range from 9 to 10
['Parasite(9.0)', 'Inception(9.1)', 'The_Godfather(9.2)', 'The_Matrix(9.3)', 'Interstellar(9.4)', 'G(9.9)', 'D(10.0)']

Rating range from 4 to 4
['A(4.0)', 'C(4.0)', 'F(4.0)']

Is this AVL Tree? True

